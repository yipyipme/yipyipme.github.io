import{c as E,r as i,k,s as l,j as e,m as F,B as y,am as B,H as b,v as L,af as M,q as D,z as I,ae as T}from"./index-Ct_SM0vh.js";import{C as w,a as V,b as $,d as _}from"./card-INzX4pkU.js";import{M as S}from"./message-square-82MjDiG_.js";import{E as U}from"./eye-C2eUJ_mm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=E("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),R=({streamId:r,isCreator:p=!1})=>{const[d,n]=i.useState([]),[c,s]=i.useState(""),[m,j]=i.useState(!1),x=i.useRef(null),{toast:h}=k(),u=()=>{var a;(a=x.current)==null||a.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{u()},[d]),i.useEffect(()=>{(async()=>{const{data:o,error:f}=await l.from("stream_chat_messages").select(`
          *,
          profiles:user_id (
            full_name,
            username
          )
        `).eq("stream_id",r).eq("status","active").order("created_at",{ascending:!0}).limit(100);if(f){console.error("Error loading messages:",f);return}n(o||[])})();const t=l.channel("stream-chat").on("postgres_changes",{event:"INSERT",schema:"public",table:"stream_chat_messages",filter:`stream_id=eq.${r}`},async o=>{const f=o.new,{data:C}=await l.from("profiles").select("full_name, username").eq("id",f.user_id).single();n(q=>[...q,{...f,profiles:C}])}).subscribe();return()=>{l.removeChannel(t)}},[r]);const g=async a=>{if(a.preventDefault(),!(!c.trim()||m)){j(!0);try{const{data:{user:t}}=await l.auth.getUser();if(!t){h({title:"Authentication Required",description:"Please sign in to chat.",variant:"destructive"});return}const{error:o}=await l.from("stream_chat_messages").insert({stream_id:r,user_id:t.id,message:c,message_type:"chat"});if(o)throw o;s("")}catch(t){console.error("Error sending message:",t),h({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{j(!1)}}},N=a=>{switch(a){case"donation":return e.jsx(b,{className:"h-4 w-4 text-red-500"});case"follow":return e.jsx(S,{className:"h-4 w-4 text-blue-500"});default:return null}},v=a=>{const t=a.profiles;return(t==null?void 0:t.full_name)||(t==null?void 0:t.username)||`User ${a.user_id.slice(0,8)}`};return e.jsxs(w,{className:"bg-gray-900 border-gray-800 h-full flex flex-col",children:[e.jsx(V,{className:"pb-3",children:e.jsxs($,{className:"text-white flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-[#FDBD34]"}),"Live Chat"]})}),e.jsxs(_,{className:"flex-1 flex flex-col p-3",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4 max-h-96",children:[d.map(a=>e.jsxs("div",{className:`p-2 rounded-lg ${a.is_highlighted?"bg-yellow-500/20 border border-yellow-500/50":"bg-gray-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[N(a.message_type),e.jsxs("span",{className:`text-sm font-medium ${a.is_moderator?"text-green-400":"text-[#FDBD34]"}`,children:[v(a),a.is_moderator&&e.jsx("span",{className:"ml-1 text-xs bg-green-500 text-black px-1 rounded",children:"MOD"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleTimeString()})]}),e.jsx("p",{className:"text-white text-sm",children:a.message}),a.donation_amount&&e.jsxs("div",{className:"mt-1 text-xs text-green-400",children:["Donated $",a.donation_amount]})]},a.id)),e.jsx("div",{ref:x})]}),e.jsxs("form",{onSubmit:g,className:"flex gap-2",children:[e.jsx(F,{value:c,onChange:a=>s(a.target.value),placeholder:"Type a message...",className:"bg-gray-800 border-gray-700 text-white",disabled:m}),e.jsx(y,{type:"submit",size:"icon",disabled:m||!c.trim(),className:"bg-[#FDBD34] text-black hover:bg-[#FDBD34]/80",children:e.jsx(B,{className:"h-4 w-4"})})]})]})]})},O=()=>{var x,h;const{streamId:r}=L(),[p,d]=i.useState(0),[n,c]=i.useState(!1),{data:s,isLoading:m}=M({queryKey:["live-stream",r],queryFn:async()=>{if(!r)throw new Error("Stream ID required");const{data:u,error:g}=await l.from("live_streams").select(`
          *,
          profiles:creator_id (
            full_name,
            username
          )
        `).eq("id",r).single();if(g)throw g;return u},enabled:!!r});if(i.useEffect(()=>{if(!s)return;d(s.current_viewers||0);const u=l.channel("stream-viewers").on("postgres_changes",{event:"UPDATE",schema:"public",table:"live_streams",filter:`id=eq.${r}`},N=>{const v=N.new;d(v.current_viewers||0)}).subscribe();return(()=>{s.status==="live"&&T.updateViewerCount(s.id,p+1)})(),()=>{l.removeChannel(u)}},[s,r]),m)return e.jsx("div",{className:"min-h-screen bg-gray-950 flex items-center justify-center",children:e.jsx("div",{className:"text-white",children:"Loading stream..."})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-950 flex items-center justify-center",children:e.jsx("div",{className:"text-white",children:"Stream not found"})});const j=((x=s.profiles)==null?void 0:x.full_name)||((h=s.profiles)==null?void 0:h.username)||"Unknown Creator";return e.jsx("div",{className:"min-h-screen bg-gray-950",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"aspect-video bg-black rounded-lg mb-4 flex items-center justify-center",children:s.status==="live"?e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📹"}),e.jsx("p",{children:"Live Stream Player"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Integration with streaming service required"})]}):e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⏰"}),e.jsxs("p",{children:["Stream is ",s.status]}),s.scheduled_start&&e.jsxs("p",{className:"text-sm text-gray-400 mt-2",children:["Scheduled for ",new Date(s.scheduled_start).toLocaleString()]})]})}),e.jsx(w,{className:"bg-gray-900 border-gray-800",children:e.jsxs(_,{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:s.title}),s.status==="live"&&e.jsx(D,{className:"bg-red-500 animate-pulse",children:"🔴 LIVE"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-4 w-4"}),p," watching"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-4 w-4"}),j]}),s.category&&e.jsx(D,{variant:"outline",className:"border-[#FDBD34] text-[#FDBD34]",children:s.category})]}),s.description&&e.jsx("p",{className:"text-gray-300 text-sm mb-4",children:s.description})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(y,{variant:n?"default":"outline",onClick:()=>c(!n),className:n?"bg-[#FDBD34] text-black":"border-gray-700 text-gray-300",children:[e.jsx(b,{className:`h-4 w-4 mr-2 ${n?"fill-current":""}`}),n?"Following":"Follow"]}),e.jsxs(y,{variant:"outline",className:"border-gray-700 text-gray-300",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Share"]}),e.jsxs(y,{variant:"outline",className:"border-gray-700 text-gray-300",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Donate"]})]})]})})]}),e.jsx("div",{className:"lg:col-span-1",children:s.chat_enabled?e.jsx(R,{streamId:s.id}):e.jsx(w,{className:"bg-gray-900 border-gray-800",children:e.jsxs(_,{className:"p-6 text-center",children:[e.jsx(S,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Chat is disabled for this stream"})]})})})]})})})};export{O as default};
