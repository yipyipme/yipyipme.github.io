import{c as q,s as d,i as B,r as x,j as e,z as S,E as F,T as U,l as W,B as f,D as $,K as I,k as P,U as k,q as E,F as L}from"./index-Ct_SM0vh.js";import{D as R,U as M,C as V,a as O,S as z}from"./CreatorStudioLayout-75gV8LXd.js";import{C as h,d as g,a as b,b as N}from"./card-INzX4pkU.js";import{E as K}from"./eye-C2eUJ_mm.js";import{R as G}from"./radio-C0_lv_wC.js";import{B as Q}from"./book-open-DSlMyBw5.js";import{M as C}from"./message-square-82MjDiG_.js";import{T as H}from"./textarea-CBKetNLb.js";import{C as T}from"./circle-check-big-JBAxZNx4.js";import{C as A}from"./circle-x-oEdiEW2d.js";import"./alert-CtKX3wDI.js";import"./circle-alert-CsA9kWpQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=q("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);class J{static async getVideoAnalytics(s){const{data:a,error:c}=await d.from("video_analytics").select(`
        *,
        videos!inner(creator_id, title)
      `).eq("videos.creator_id",s);if(c)throw c;return a||[]}static async getRevenueAnalytics(s,a=30){const c=new Date;c.setDate(c.getDate()-a);const{data:i,error:o}=await d.from("revenue_analytics").select("*").eq("creator_id",s).gte("date",c.toISOString().split("T")[0]).order("date",{ascending:!0});if(o)throw o;return i||[]}static async trackViewerSession(s){const{data:a,error:c}=await d.from("viewer_sessions").insert({video_id:s.videoId,stream_id:s.streamId,viewer_id:s.viewerId,session_id:s.sessionId,device_type:s.deviceType,browser:s.browser,country:s.country,referrer:s.referrer}).select().single();if(c)throw c;return a}static async endViewerSession(s,a,c){const{error:i}=await d.from("viewer_sessions").update({watch_end:new Date().toISOString(),watch_duration:a,progress_percent:c}).eq("session_id",s);if(i)throw i}static async getDashboardMetrics(s){const{data:a,error:c}=await d.from("video_analytics").select(`
        view_count,
        total_watch_time,
        videos!inner(creator_id)
      `).eq("videos.creator_id",s);if(c)throw c;const i=(a==null?void 0:a.reduce((r,n)=>r+(n.view_count||0),0))||0,o=(a==null?void 0:a.reduce((r,n)=>r+(n.total_watch_time||0),0))||0,u=i>0?o/i:0,{data:m,error:p}=await d.from("revenue_analytics").select("total_revenue").eq("creator_id",s);if(p)throw p;const y=(m==null?void 0:m.reduce((r,n)=>r+(n.total_revenue||0),0))||0,{data:j,error:t}=await d.from("creator_profiles").select("subscriber_count").eq("id",s).single();if(t&&t.code!=="PGRST116")throw t;return{totalViews:i,totalRevenue:y,subscriberCount:(j==null?void 0:j.subscriber_count)||0,averageWatchTime:u}}}const Y=()=>{const{user:l}=B(),[s,a]=x.useState({totalViews:0,totalRevenue:0,subscriberCount:0,averageWatchTime:0}),[c,i]=x.useState(!0),[o,u]=x.useState("");x.useEffect(()=>{(async()=>{if(l)try{i(!0);const r=await J.getDashboardMetrics(l.id);a(r)}catch(r){console.error("Error loading metrics:",r),u(r.message)}finally{i(!1)}})()},[l]);const m=t=>t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString(),p=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),y=t=>{const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}:${n.toString().padStart(2,"0")}`};if(c)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((t,r)=>e.jsx(h,{className:"bg-gray-900 border-gray-800 animate-pulse",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded"})]})},r))});if(o)return e.jsx(h,{className:"bg-gray-900 border-gray-800",children:e.jsx(g,{className:"p-6 text-center",children:e.jsxs("p",{className:"text-red-400",children:["Error loading metrics: ",o]})})});const j=[{title:"Total Views",value:m(s.totalViews),icon:K,change:"+12%",trend:"up",color:"text-blue-400"},{title:"Revenue",value:p(s.totalRevenue),icon:R,change:"+8.2%",trend:"up",color:"text-green-400"},{title:"Subscribers",value:m(s.subscriberCount),icon:S,change:"+15%",trend:"up",color:"text-purple-400"},{title:"Avg Watch Time",value:y(s.averageWatchTime),icon:F,change:"-2%",trend:"down",color:"text-orange-400"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:j.map((t,r)=>e.jsx(h,{className:"bg-gray-900/50 border-gray-800 card-hover",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm font-medium",children:t.title}),e.jsx("p",{className:"text-2xl font-bold text-white mt-2",children:t.value}),e.jsxs("div",{className:"flex items-center mt-2",children:[t.trend==="up"?e.jsx(U,{className:"h-3 w-3 text-green-400 mr-1"}):e.jsx(X,{className:"h-3 w-3 text-red-400 mr-1"}),e.jsx("span",{className:`text-xs ${t.trend==="up"?"text-green-400":"text-red-400"}`,children:t.change}),e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"vs last month"})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-gray-800/50",children:e.jsx(t.icon,{className:`h-6 w-6 ${t.color}`})})]})})},r))})},Z=({onUploadClick:l})=>{const s=W(),c=[{title:"Upload Video",description:"Share new content",icon:M,color:"bg-[#FDBD34] text-black hover:bg-[#FDBD34]/80",onClick:l},{title:"Schedule Stream",description:"Plan live service",icon:G,color:"border-red-500/50 text-red-400 hover:bg-red-500/10",onClick:()=>{s("/creator-studio/live")}},{title:"Create Post",description:"Engage community",icon:Q,color:"border-blue-500/50 text-blue-400 hover:bg-blue-500/10"},{title:"View Analytics",description:"Check performance",icon:V,color:"border-purple-500/50 text-purple-400 hover:bg-purple-500/10"},{title:"Manage Members",description:"Support community",icon:S,color:"border-green-500/50 text-green-400 hover:bg-green-500/10"},{title:"Respond to Comments",description:"12 pending",icon:C,color:"border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10"}];return e.jsxs(h,{className:"bg-gray-900/50 border-gray-800 w-full",children:[e.jsx(b,{className:"pb-4",children:e.jsx(N,{className:"text-white text-xl",children:"Quick Actions"})}),e.jsx(g,{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 w-full",children:c.map((i,o)=>e.jsxs(f,{variant:i.title==="Upload Video"?"default":"outline",onClick:i.onClick,className:`flex flex-col items-center justify-center h-20 btn-modern text-xs px-3 py-3 w-full ${i.title==="Upload Video"?i.color:`border-gray-700 ${i.color}`}`,children:[e.jsx(i.icon,{className:"h-5 w-5 mb-2 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-center leading-tight text-xs",children:i.title}),e.jsx("span",{className:"text-[10px] opacity-75 text-center leading-tight mt-1",children:i.description})]},o))})})]})},ee=()=>{const l=[{type:"upload",title:"Sunday Service: Walking by Faith",time:"2 hours ago",views:"1.2K views",icon:M,color:"text-blue-400"},{type:"subscriber",title:"New subscriber milestone reached",time:"4 hours ago",views:"8,745 subscribers",icon:S,color:"text-green-400"},{type:"comment",title:'New comments on "Prayer Night"',time:"6 hours ago",views:"12 new comments",icon:C,color:"text-yellow-400"},{type:"donation",title:"Donation received from supporter",time:"8 hours ago",views:"$50 donation",icon:R,color:"text-purple-400"},{type:"live",title:"Wednesday Bible Study ended",time:"1 day ago",views:"89 viewers",icon:I,color:"text-red-400"}];return e.jsxs(h,{className:"bg-gray-900/50 border-gray-800 h-fit",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-white flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-[#FDBD34]"}),"Recent Activity"]})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:l.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-4 p-3 rounded-lg bg-gray-800/30 hover:bg-gray-800/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center",children:e.jsx(s.icon,{className:`h-4 w-4 ${s.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium text-sm line-clamp-2",children:s.title}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:s.time})]}),e.jsx("div",{className:"text-[#FDBD34] text-xs font-medium shrink-0",children:s.views})]},a))})})]})},te=()=>e.jsxs(h,{className:"bg-gray-900/50 border-gray-800",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"text-white flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-[#FDBD34]"}),"Performance Trends"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",className:"border-gray-700 text-gray-300 hover:text-[#FDBD34]",children:"7 Days"}),e.jsx(f,{variant:"outline",size:"sm",className:"border-gray-700 text-gray-300 hover:text-[#FDBD34]",children:"30 Days"})]})]})}),e.jsx(g,{children:e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-400",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(U,{className:"h-16 w-16 mx-auto text-[#FDBD34]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Interactive Chart Coming Soon"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Track your views, watch time, and engagement over time"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 text-center",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:"+15%"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Views"})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:"+8%"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Watch Time"})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:"+23"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Subscribers"})]})]})]})})})]}),se=()=>{const[l,s]=x.useState([]),[a,c]=x.useState(!0),[i,o]=x.useState({}),{toast:u}=P();x.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:t,error:r}=await d.from("creator_applications").select("*").order("submitted_at",{ascending:!1});if(r)throw r;const n=(t==null?void 0:t.map(v=>({...v,status:v.status==="suspended"?"pending":v.status})))||[];s(n)}catch(t){console.error("Error fetching applications:",t),u({title:"Error",description:"Failed to fetch creator applications",variant:"destructive"})}finally{c(!1)}},p=async(t,r)=>{try{const n=i[t]||"",{error:v}=await d.from("creator_applications").update({status:r,reviewed_at:new Date().toISOString(),review_notes:n}).eq("id",t);if(v)throw v;if(r==="approved"){const w=l.find(_=>_.id===t);if(w){const{error:_}=await d.from("profiles").update({role:"creator"}).eq("id",w.user_id);if(_)throw _;const{error:D}=await d.from("creator_profiles").insert({id:w.user_id,channel_name:w.channel_name,channel_description:w.channel_description});if(D)throw D}}u({title:"Success",description:`Application ${r} successfully`}),m()}catch(n){console.error("Error reviewing application:",n),u({title:"Error",description:"Failed to review application",variant:"destructive"})}},y=t=>{switch(t){case"approved":return e.jsx(T,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(A,{className:"h-4 w-4 text-red-500"});default:return e.jsx(F,{className:"h-4 w-4 text-yellow-500"})}},j=t=>{switch(t){case"approved":return"bg-green-500/20 text-green-400 border-green-500/30";case"rejected":return"bg-red-500/20 text-red-400 border-red-500/30";default:return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"}};return a?e.jsxs(h,{className:"bg-gray-900/50 border-gray-800",children:[e.jsx(b,{children:e.jsx(N,{className:"text-white",children:"Creator Applications"})}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-8 w-8 animate-spin border-4 border-[#FDBD34] border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading applications..."})]})})]}):e.jsxs(h,{className:"bg-gray-900/50 border-gray-800",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-white flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Creator Applications",l.filter(t=>t.status==="pending").length>0&&e.jsxs(E,{className:"bg-[#FDBD34] text-black",children:[l.filter(t=>t.status==="pending").length," pending"]})]})}),e.jsx(g,{children:l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No creator applications yet"})]}):e.jsx("div",{className:"space-y-6",children:l.map(t=>e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:t.channel_name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[y(t.status),e.jsx(E,{className:j(t.status),children:t.status.toUpperCase()})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),new Date(t.submitted_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-4 w-4"}),t.content_type]})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Channel Description"}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.channel_description})]}),t.ministry_background&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Ministry Background"}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.ministry_background})]}),t.sample_content_urls&&t.sample_content_urls.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Sample Content"}),e.jsx("div",{className:"space-y-1",children:t.sample_content_urls.map((r,n)=>e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"text-[#FDBD34] hover:underline text-sm block",children:r},n))})]})]}),t.status==="pending"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{placeholder:"Add review notes (optional)",value:i[t.id]||"",onChange:r=>o(n=>({...n,[t.id]:r.target.value})),className:"bg-gray-800 border-gray-700 text-white"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:()=>p(t.id,"approved"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(f,{onClick:()=>p(t.id,"rejected"),variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]}),t.review_notes&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-700/50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Review Notes"}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.review_notes})]})]},t.id))})})]})},ue=()=>{const{profile:l}=B(),[s,a]=x.useState(!1),c=()=>{a(!0)},i=()=>{a(!1)};return e.jsxs(O,{children:[e.jsxs("div",{className:"w-full h-full space-y-8",children:[e.jsxs("div",{className:"text-center w-full",children:[e.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Welcome to Creator Studio"}),e.jsx("p",{className:"text-gray-400 text-lg max-w-2xl mx-auto",children:"Manage your channel, upload content, and connect with your audience. Spread the Gospel through digital media."})]}),(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(se,{}),e.jsx("div",{className:"border-t border-gray-800 pt-6",children:e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Dashboard Overview"})})]}),e.jsx("div",{className:"w-full",children:e.jsx(Y,{})}),e.jsx("div",{className:"w-full",children:e.jsx(Z,{onUploadClick:c})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8 w-full",children:[e.jsx("div",{className:"w-full",children:e.jsx(te,{})}),e.jsx("div",{className:"w-full",children:e.jsx(ee,{})})]})]}),s&&e.jsx(z,{onClose:()=>a(!1),onSuccess:i})]})};export{ue as default};
